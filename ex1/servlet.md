### Как работают сервлеты

**Сервлеты** — это Java-компоненты, работающие на сервере и используемые для обработки HTTP-запросов и генерации HTTP-ответов. Они позволяют разрабатывать веб-приложения на Java, обеспечивая динамическую обработку запросов, как, например, обработка данных форм, работа с сессиями пользователей и генерация динамического контента.

Когда пользователь отправляет запрос (например, через браузер) к серверу, этот запрос проходит через веб-сервер (например, Tomcat), который перенаправляет запрос на соответствующий сервлет. Сервлет обрабатывает запрос, выполняет необходимые действия (например, обращение к базе данных) и возвращает ответ клиенту.

---

### Контейнер сервлетов

**Контейнер сервлетов** (или веб-контейнер) — это часть веб-сервера (например, Apache Tomcat), которая управляет жизненным циклом сервлетов, обработкой HTTP-запросов и выполнением других вспомогательных задач, таких как управление сессиями, безопасностью и настройкой ресурсов.

Основные функции контейнера сервлетов:
- Загрузка и инициализация сервлетов.
- Управление жизненным циклом сервлетов.
- Обработка HTTP-запросов и их перенаправление к нужным сервлетам.
- Управление сессиями пользователей.
- Обеспечение безопасности через аутентификацию и авторизацию.

Контейнер сервлетов обеспечивает выполнение сервлетов в многопоточном режиме и позволяет обрабатывать несколько запросов одновременно.

---

### Жизненный цикл сервлета

Жизненный цикл сервлета включает в себя три ключевых этапа:

1. **Создание и инициализация сервлета** (`init`):
    - Когда контейнер впервые обращается к сервлету, он создает его экземпляр.
    - После создания экземпляра вызывается метод `init()`, который инициализирует сервлет и готовит его к обработке запросов. Этот метод вызывается только один раз за время жизни сервлета.

   ```java
   @Override
   public void init() throws ServletException {
       // Инициализация сервлета
   }
   ```

2. **Обработка запросов** (`service`):
    - После инициализации, контейнер передает запросы к сервлету через метод `service()`. Этот метод обрабатывает запросы и отправляет ответы. В большинстве случаев, `service()` делегирует работу методам `doGet()`, `doPost()` и другим методам, специфичным для HTTP-запросов.

   ```java
   @Override
   protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
       // Обработка запросов
   }
   ```

3. **Завершение работы сервлета** (`destroy`):
    - Когда контейнер сервлетов решает удалить сервлет (например, при завершении работы приложения или сервера), вызывается метод `destroy()`. Этот метод используется для освобождения ресурсов, связанных с сервлетом, например, закрытия подключений к базе данных.

   ```java
   @Override
   public void destroy() {
       // Завершение работы сервлета
   }
   ```

#### Основные этапы жизненного цикла:
- **Загрузка сервлета**: Контейнер сервлетов загружает класс сервлета в память.
- **Создание экземпляра сервлета**: Контейнер создает объект сервлета.
- **Инициализация сервлета**: Метод `init()` вызывается один раз.
- **Обработка запросов**: Каждый запрос обрабатывается через метод `service()` (вызывает `doGet()`, `doPost()` и т.д.).
- **Завершение**: Метод `destroy()` вызывается для освобождения ресурсов перед завершением работы.

---

### Пример сервлета:

```java
import javax.servlet.*;
import javax.servlet.http.*;
import java.io.IOException;

public class MyServlet extends HttpServlet {
    @Override
    public void init() throws ServletException {
        // Инициализация сервлета
        System.out.println("Servlet initialized");
    }

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // Обработка GET-запроса
        resp.setContentType("text/html");
        resp.getWriter().println("<h1>Hello, World!</h1>");
    }

    @Override
    public void destroy() {
        // Завершение работы сервлета
        System.out.println("Servlet destroyed");
    }
}
```

Этот сервлет выводит "Hello, World!" при каждом GET-запросе и демонстрирует основные этапы жизненного цикла: инициализацию, обработку запроса и завершение работы.